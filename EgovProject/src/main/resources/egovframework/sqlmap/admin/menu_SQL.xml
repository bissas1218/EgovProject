<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Menu">

	<typeAlias  alias="egovMap" type="org.egovframe.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="hashMap" type="java.util.HashMap"/>
	
	<select id="menuDAO.selectMenuList" resultClass="egovMap">
			
			SELECT 
 				CASE WHEN LEVEL-1 > 0 THEN CONCAT(CONCAT(REPEAT('   ', level - 1),'â”—'), (select nm from menu where id=fnc.id)) 
 				ELSE (select nm from menu where id=fnc.id)
 				END AS hierarchi_nm,
				fnc.id menu_cd, 
				(select p_id from menu where id=fnc.id) p_menu_cd, 
				fnc.level level, 
				(select nm from menu where id=fnc.id) menu_nm,
				(select url from menu where id=fnc.id) url,
				(select depth from menu where id=fnc.id) depth,
				(select type from menu where id=fnc.id) type
			FROM (
				SELECT fnc_hierarchi() AS id, @LEVEL AS level FROM (
					SELECT @start_with:=0, @id:=@start_with, @LEVEL:=0) vars
					JOIN menu
				WHERE @id IS NOT NULL) fnc
	</select>
	
	<select id="menuDAO.selectMenuDepth1List" resultClass="egovMap">
			
			SELECT * FROM MENU WHERE DEPTH = 1
			
	</select>
	
	<select id="menuDAO.selectMenuDepth2List" resultClass="hashMap" parameterClass="String">
			
			SELECT * FROM MENU WHERE P_ID = #pMenuCd#
			
	</select>
	
	<select id="menuDAO.selectMenuInfo" parameterClass="String" resultClass="egovMap">
			
			SELECT * FROM menu WHERE id = (
				SELECT CASE WHEN (
				SELECT depth
				FROM MENU
				WHERE ID = #menuCd#) = 1 THEN (
				SELECT id
				FROM menu
				WHERE p_id = #menuCd# LIMIT 1) ELSE (
				SELECT id
				FROM menu
				WHERE id = #menuCd#) END
				FROM DUAL)
			
	</select>
	
	<update id="menuDAO.updateMenu" parameterClass="hashMap">
		
		UPDATE MENU SET
			NM = #menuNm#,
			TYPE = #type#,
			URL = #url#
			WHERE id = #menuCd#
			
	</update>

	<insert id="menuDAO.insertMenu" parameterClass="hashMap">
	
		<selectKey keyProperty="menuCd" resultClass="Integer">
		SELECT max(id)+1 newMenuCd FROM menu
		</selectKey>
		
		INSERT INTO MENU (
			id,
			nm,
			p_id,
			URL, 
			DEPTH,
			TYPE
		)VALUES(
			#menuCd#,
			#menuNm#,
			#pMenuCd#,
			#url#,
			#depth#,
			#type#
		)
	</insert>
	
	<select id="menuDAO.selectContentId" parameterClass="String" resultClass="Integer">
		SELECT COUNT(*) FROM CONTENT WHERE ID = #menuCd#
	</select>
	
	<update id="menuDAO.updateContent" parameterClass="hashMap">
		
		UPDATE CONTENT SET
			CONTENT = #content#
			WHERE id = #menuCd#
			
	</update>
	
	<insert id="menuDAO.insertContent" parameterClass="hashMap">
	
		INSERT INTO CONTENT (
			id,
			content
		)VALUES(
			#menuCd#,
			#content#
		)
		
	</insert>
	
	<select id="menuDAO.selectContent" parameterClass="String" resultClass="EgovMap">
		SELECT content FROM CONTENT WHERE ID = #menuCd#
	</select>
	
</sqlMap>
