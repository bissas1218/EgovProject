<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="UserMain">

	<typeAlias alias="egovMap" type="org.egovframe.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias alias="menuVO" type="egovframework.example.sample.service.MenuVO"/>
	
	<resultMap id="menuMap" class="egovframework.example.sample.service.MenuVO">
		<result property="menuId" column="MENU_ID"/>
		<result property="pMenuId" column="P_MENU_ID"/>
		<result property="menuNm" column="MENU_NM"/>
		<result property="level" column="LEVEL"/>
	</resultMap>
	
	<select id="UserMainDAO.selectUserMenuList" resultMap="menuMap">
	<![CDATA[
		WITH RECURSIVE CTE AS
				(
					SELECT t1.MENU_ID, t1.MENU_NM, t1.P_MENU_ID, 1 as LEVEL
					FROM MENU t1
					WHERE t1.P_MENU_ID = '##'		
					UNION ALL		
					SELECT t2.MENU_ID, t2.MENU_NM, t2.P_MENU_ID, 1 + level as LEVEL
					FROM MENU t2
					INNER JOIN CTE ON t2.P_MENU_ID = CTE.MENU_ID
				)		
				SELECT CTE.MENU_ID, CTE.MENU_NM, CTE.P_MENU_ID, CTE.LEVEL FROM CTE
	]]>
	</select>
	
</sqlMap>
